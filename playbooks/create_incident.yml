---
- name: Criar incidentes de teste no ServiceNow com categorias diferentes
  hosts: localhost
  connection: local
  gather_facts: false
  collections:
    - servicenow.itsm

  vars:
    sn_instance: "{{ lookup('env', 'SN_HOST') }}"
    sn_username: "{{ lookup('env', 'SN_USERNAME') }}"
    sn_password: "{{ lookup('env', 'SN_PASSWORD') }}"

    categorias_teste:
      - Software
      - Hardware
      - Network

  tasks:
    - name: Criar incidentes de teste
      servicenow.itsm.incident:
        instance:
          host: "{{ sn_instance }}"
          username: "{{ sn_username }}"
          password: "{{ sn_password }}"
        state: present
        short_description: "Incidente de teste autom√°tico - Categoria {{ item }}"
        description: "Este incidente foi criado automaticamente pelo Ansible para fins de teste (Categoria: {{ item }})"
        impact: 3        # Low
        urgency: 2       # Medium
        caller: "Anshul Demouser"
        other:
          category: "{{ item }}"
          work_notes: "Criado automaticamente para testes de SLA"
      loop: "{{ categorias_teste }}"
      register: incidentes

    - name: Mostrar incidentes criados
      debug:
        msg: "Incidentes criados: {{ incidentes.results | map(attribute='record.number') | list }}"
